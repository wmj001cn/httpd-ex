Vue.use(Toasted);var tableNumber=getQuerystring("tableNumber",null);function getQuerystring(a,b){null==b&&(b="");var c=unescape(location.search);if(""==c)return b;c=c.substr(1);for(var d,e=c.split("&"),f=0;f<e.length;f++)if(d=e[f].split("="),d[0]==a)return d[1];return b}var app=new Vue({el:"#app",data:{chillyMap:["\u4E0D\u8FA3","\u5FAE\u8FA3","\u4E2D\u8FA3","\u8D85\u8FA3"],showRemark:!1,useOldDelivery:!1,active_el2:"tm",active_el:"tp",orderNumber:"",selected:"first",options:[],isOutShow:!1,showModal:!1,showCat:1,paySuccess:!1,showPayQR:0,showCart:!1,showMyPay:0,order:{diceCount:0,remark:"",merchatId:merchatId,delivery:{},tableNumber:tableNumber,items:{},isOut:null==tableNumber||""==tableNumber},realisticPay:0,tableNumber:tableNumber,receiveClass:!1,isActive:!1,secondCats:{},showSecondCats:!1,all:myall,items:defaultk},mounted:()=>{$(".items").flyto({item:".product",target:".cart",button:".add"})},methods:{getOItem:function(a){return this.order.items[this.getProductSku(a.sku,[a.type,a.chillyLevel])]},monitorPay:function(){var a=this;setTimeout(()=>{var b=jQuery("#receiveQR");b.longpress(function(){a.realisticPay=!0,a.$toasted.error("\u70B9\u8BC6\u522B\u4E8C\u7EF4\u7801!",{duration:8e3,position:"top-right",fitToScreen:!0})},function(){},600)},1e3)},saveDelivery:function(){this.$cookies.set("mobile",this.order.delivery.mobile,{expires:7}),this.$cookies.set("address",this.order.delivery.address,{expires:7})},gotoPay:function(){var a=this;if(this.isEmptyObject(this.order.items))return void a.$toasted.error("\u4F60\u7684\u8D2D\u7269\u8F66\u4E3A\u7A7A!",{duration:3e3,position:"top-right"});if(this.order.isOut){if(this.order.delivery.mobile&&this.order.delivery.address)this.$cookies.set("mobile",this.order.delivery.mobile,{expires:7}),this.$cookies.set("address",this.order.delivery.address,{expires:7});else{var b=this.$cookies.get("mobile"),c=this.$cookies.get("address");if(b&&c)this.order.delivery.mobile=b,this.order.delivery.address=c;else return a.$toasted.error("\u8BF7\u586B\u5B8C\u6574\u7684\u5916\u5356\u9001\u8D27\u4FE1\u606F!",{duration:3e3,position:"top-right"}),void(this.isOutShow=!0)}}else if(this.order.delivery.mobile&&this.order.delivery.address);else if(null==this.tableNumber||""==this.tableNumber)return a.$toasted.error("\u8BF7\u586B\u5B8C\u6574\u7684\u5916\u5356\u9001\u8D27\u4FE1\u606F!",{duration:3e3,position:"top-right"}),void(this.isOutShow=!0);this.showCart=!1,$("#mask").hide(),$(".bottom").hide(),$(".top").hide(),this.showPayQR=!this.showPayQR},onTap:function(a){var b=$.extend({},a),c=b.sku,d=this,e=d.order,f=e.items;b.type!=void 0&&(c+="-"+b.type,b.desc=b.desc.replace("\u7C89/\u9762",catAttr[b.cat].mytype[b.type])),b.chillyLevel!=void 0&&(c+="-"+b.chillyLevel,b.desc+="("+this.chillyMap[b.chillyLevel]+")"),f&&f[c]?++f[c].qty:(this.$set(f,c,b),this.$set(f[c],"qty",1))},getProductSku:function(a,b){var c=a;return b.forEach(function(a){void 0!=a&&(c+="-"+a)}),c},onTapIncreaseOnly:function(a){var b=$.extend({},a),c=b.sku,d=this,e=d.order,f=e.items,g="packQty";if(void 0!=b.type&&(c+="-"+b.type,b.desc=b.desc.replace("\u7C89/\u9762",catAttr[b.cat].mytype[b.type])),void 0!=b.chillyLevel&&(c+="-"+b.chillyLevel,b.desc+="("+this.chillyMap[b.chillyLevel]+")"),f&&f[c]){var h=(f[c][g]?f[c][g]:0)+1;this.$set(f[c],g,h)}else this.$set(f,c,b),this.$set(f[c],g,1)},decrease:function(a,b){var c=this.getProductSku(a.sku,[a.type,a.chillyLevel]),d=this,e=d.order,f=e.items;if(f&&f[c]){var g=b?"packQty":"qty",h=f[c][g]-1;if(0<h){var i=this.order.items[c];i[g]--,f[c][b?"packQty":"qty"]=h}}},isEmptyObject:function(a){for(var b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!1;return!0},submit:function(){var a=this;return a.realisticPay?void(this.receiveClass=!0,this.order.total=this.sumByKey(this.items),$.ajax({type:"POST",url:"http://yeech.pe.hu/RealState/index.php/api/submit",data:{order:this.order},dataType:"json",success:function(b){a.receiveClass=!1,a.orderNumber=b.orderNumber,a.paySuccess=1,a.showMyPay=0,a.$toasted.success("\u8BA2\u5355\u5DF2\u63D0\u4EA4\u6210\u529F, \u8BF7\u8010\u5FC3\u7B49\u5019!",{duration:6e3,position:"bottom-right"})},error:function(){a.$toasted.success("\u63D0\u4EA4\u5931\u8D25!",{duration:5e3,position:"bottom-right"}),a.showMyPay=0}})):void a.$toasted.error("\u4F60\u8FD8\u6CA1\u652F\u4ED8\u5462\uFF0C \u5148\u8BF7\u5148\u652F\u4ED8\u540E\u624D\u53EF\u4EE5\u6210\u529F\u4E0B\u5355\u54E6\uFF01\u957F\u6309\u4EE5\u4E0B\u4E8C\u7EF4\u7801 \u261F\u261F\u261F",{duration:3e3,position:"top-right"})},showMyCart:function(){$("#mask").toggle(),this.showCart=!this.showCart},chnageCat:function(a,b){if(this.secondCats=this.all[a],this.showSecondCats=!this.showSecondCats,this.active_el=a,b){var c=this.all[a],d=[];for(k in c)console.log(c[k]),d=d.concat(c[k]);this.items=d}},goCat:function(a,b){this.active_el=a,this.active_el2=a+b,setTimeout(function(){$(".items").flyto({item:".product",target:".cart",button:".add"})},500),this.items=b?this.all[a][b]:this.all[a]},toUrl:function(a){var b=a.split("-")[0];return"images/menu_item/"+b+".jpg"},getTotal:function(a){var b=this.sumByKey(a);return 20<b?b:b+1},sumByKey:function(a){var b=0;for(k in a){var c=a[k],d=c.qty?c.qty:0,e=c.packQty?c.packQty:0;b+=(d+e)*c.price}return b},sumByKeyOnly:function(a,b,c){var d=0;for(k in a){var e=a[k];d+=e[b],c&&(d+=e[c])}return d},getCatAttrById:function(a){return console.log(catAttr[a.cat]),void 0==catAttr[a.cat]?(console.log(a.sku),[]):catAttr[a.cat].mytype}}});Vue.component("modal",{template:"#modal-template"});